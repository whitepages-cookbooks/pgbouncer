[databases]
<%= @db_alias %> = host=<%= @db_host %> port=<%= @db_port %> dbname=<%= @db_name %> <%= "connect_query='#{@connect_query}'" unless @connect_query.nil? || @connect_query.empty? %>

[pgbouncer]

logfile = <%= @log_dir %>/pgbouncer-<%= @db_alias %>.log
pidfile = <%= @pid_dir %>/pgbouncer-<%= @db_alias %>.pid

<%= ";" if @listen_addr.nil? || @listen_addr.empty? %>listen_addr = <%= @listen_addr %>
<%= ";" if @listen_port.nil? || @listen_port.empty? %>listen_port = <%= @listen_port %>

unix_socket_dir = <%= @socket_dir %>/<%= @db_alias %>/

auth_type = <%= @auth_type %>
auth_file = /etc/pgbouncer/userlist-<%= @db_alias %>.txt

admin_users = <%= @auth_type.join(',') %>
stats_users = pgbouncer_monitor

pool_mode = <%= @pool_mode %>

server_reset_query = <%= @server_reset_query %>

max_client_conn = <%= @max_client_conn %>
default_pool_size = <%= @default_pool_size %>
min_pool_size = <%= @min_pool_size %>
reserve_pool_size = <%= @reserve_pool_size %>
server_round_robin = <%= @server_round_robin %>
server_idle_timeout = <%= @server_idle_timeout %>

<%= defined?(@tcp_keepalive) ? "tcp_keepalive = #{@tcp_keepalive}" : ";tcp_keepalive = 1" %>
<%= defined?(@tcp_keepidle) ? "tcp_keepidle = #{@tcp_keepidle}" : ";tcp_keepidle = 0" %>
<%= defined?(@tcp_keepintvl) ? "tcp_keepintvl = #{@tcp_keepintvl}" : ";tcp_keepintvl = 0" %>

<% @additional.each do |key, value| %>
<%= key %> = <%= value %>
<% end %>
