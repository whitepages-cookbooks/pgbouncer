[databases]
<% @databases.each do |database| %>
<%= database[:db_alias] %> = <% "host='#{database[:db_host]}' " unless database[:db_host].nil? || database[:db_host].empty? %>port=<%= database[:db_port] %> dbname=<%= database[:db_name] %> <%= "connect_query='#{@connect_query}'" unless @connect_query.nil? || @connect_query.empty? %>
<% end %>

[pgbouncer]

logfile = <%= @log_dir %>/pgbouncer-<%= @instance_name %>.log
pidfile = <%= @pid_dir %>/pgbouncer-<%= @instance_name %>.pid

<%= ";" if @listen_addr.nil? || @listen_addr.empty? %>listen_addr = <%= @listen_addr %>
<%= ";" if @listen_port.nil? || @listen_port.empty? %>listen_port = <%= @listen_port %>

unix_socket_dir = <%= "#{@socket_dir}/" unless @socket_dir.empty? %>

auth_type = <%= @auth_type %>
auth_file = /etc/pgbouncer/userlist-<%= @instance_name %>.txt

admin_users = <%= @admin_users.join(',') %>
stats_users = <%= @stats_users.join(',') %>

pool_mode = <%= @pool_mode %>

server_reset_query = <%= @server_reset_query %>

max_client_conn = <%= @max_client_conn %>
default_pool_size = <%= @default_pool_size %>
min_pool_size = <%= @min_pool_size %>
reserve_pool_size = <%= @reserve_pool_size %>
server_round_robin = <%= @server_round_robin %>
server_idle_timeout = <%= @server_idle_timeout %>

<%= defined?(@tcp_keepalive) ? "tcp_keepalive = #{@tcp_keepalive}" : ";tcp_keepalive = 1" %>
<%= defined?(@tcp_keepidle) ? "tcp_keepidle = #{@tcp_keepidle}" : ";tcp_keepidle = 0" %>
<%= defined?(@tcp_keepintvl) ? "tcp_keepintvl = #{@tcp_keepintvl}" : ";tcp_keepintvl = 0" %>

<% @additional.each do |key, value| %>
<%= key %> = <%= value %>
<% end %>
